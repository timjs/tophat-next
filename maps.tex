% !TEX root=main.tex


\newmacro{O-Value}{
  \begin{function}
    \signature{\Value : \mathrm{Tasks} \times \mathrm{States} \rightharpoonup \mathrm{Values}} \\
    \Value(\Enter \beta, \sigma)                       &=& \bot \\
    \Value(\Update b, \sigma)                          &=& b \\
    \Value(\View b, \sigma)                            &=& b \\
    \Value(\Pick \set{\more{L_i \mapsto t_i}}, \sigma) &=& \bot \\
  \addlinespace
    \Value(\Done v, \sigma)                            &=& v \\
    \Value(t_1 \Pair t_2, \sigma)                      &=& \left\{
      \begin{array}{ll}
        \tuple{v_1, v_2}                               & \ \when\ \Value(t_1, \sigma) = v_1 \land \Value(t_2, \sigma) = v_2 \\
        \bot                                           & \ \otherwise \\
      \end{array}
    \right. \\
    \Value(t_1 \Choose t_2, \sigma)                    &=& \left\{
      \begin{array}{ll}
        v_1                                            & \ \when\ \Value(t_1, \sigma) = v_1 \\
        v_2                                            & \ \when\ \Value(t_1, \sigma) = \bot \land \Value(t_2, \sigma) = v_2 \\
        \obox{\tuple{v_1, v_2}}{\bot}                  & \ \otherwise \\
      \end{array}
    \right. \\
    \Value(\Fail, \sigma)                              &=& \bot \\
  \addlinespace
    \Value(e_1 \Trans t_2, \sigma)                     &=& v_2' \quad\when \Value(t_2) = v_2 \land e_1\ v_2 \eval v_2' \\
    \Value(t_1 \Step e_2, \sigma)                      &=& \bot \\
    \Value(\Forever t, \sigma)                         &=& \bot \\
  \addlinespace
    % \Value(\Share b, \sigma)                           &=& \bot \\
    % \Value(l \Assign b, \sigma)                        &=& \unit \\
    \Value(\Change l, \sigma)                          &=& \sigma(l) \\
    \Value(\Watch l, \sigma)                           &=& \sigma(l) \\
  \end{function}
}

\newmacro{O-Failing}{
  \begin{function}
    \signature{\Failing : \mathrm{Tasks} \to \mathrm{Booleans}} \\
    % \Failing(\Enter \beta)                       &=& \False \\
    % \Failing(\Update b)                          &=& \False \\
    % \Failing(\View b)                            &=& \False \\
    \Failing(\Pick \set{\more{L_i \mapsto t_i}}) &=& \bigwedge \set{\Failing(t_i) \mid \text{for each $i$}} \\
  \addlinespace
    % \Failing(\Done b)                            &=& \False \\
    \Failing(t_1 \Pair t_2)                      &=& \Failing(t_1) \land \Failing(t_2) \\
    \Failing(t_1 \Choose t_2)                    &=& \Failing(t_1) \land \Failing(t_2) \\
    \Failing(\Fail)                              &=& \True \\
  \addlinespace
    \Failing(e_1 \Trans t_2)                     &=& \Failing(t_2) \\
    \Failing(t_1 \Step e_2)                      &=& \Failing(t_1) \\
    \Failing(\Forever t)                         &=& \Failing(t) \\
  % \addlinespace
    % \Failing(\Share b)                           &=& \False \\
    % \Failing(l \Assign b)                        &=& \False \\
    % \Failing(\Change l)                          &=& \False \\
    % \Failing(\Watch l)                           &=& \False \\
  \addlinespace
    \Failing(\_)                                 &=& \False \\
  \end{function}
}

\newmacro{O-Watching}{
  \begin{function}
    \signature{\Watching : \mathrm{Tasks} \to \powerset{\mathrm{Locations}}} \\
    % \Watching(\Enter \beta)                       &=& \nothing \\
    % \Watching(\Update b)                          &=& \nothing \\
    % \Watching(\View b)                            &=& \nothing \\
    % \Watching(\Pick \set{\more{L_i \mapsto t_i}}) &=& \nothing \\
  % \addlinespace
    % \Watching(\Done b)                            &=& \nothing \\
    \Watching(t_1 \Pair t_2)                      &=& \Watching(t_1) \cup \Watching(t_2) \\
    \Watching(t_1 \Choose t_2)                    &=& \Watching(t_1) \cup \Watching(t_2) \\
    % \Watching(\Fail)                              &=& \nothing \\
  \addlinespace
    \Watching(e_1 \Trans t_2)                     &=& \Watching(t_2) \\
    \Watching(t_1 \Step e_2)                      &=& \Watching(t_1) \\
    \Watching(\Forever t)                         &=& \Watching(t) \\
  \addlinespace
    % \Watching(\Share b)                           &=& \nothing \\
    % \Watching(l \Assign b)                        &=& \nothing \\
    \Watching(\Change l)                          &=& \set{l} \\
    \Watching(\Watch l)                           &=& \set{l} \\
  \addlinespace
    \Watching(\_)                                 &=& \nothing \\
  \end{function}
}

\newmacro{O-Picks}{
  \begin{function}
    \signature{\Picks : \mathrm{Tasks} \to \powerset{\mathrm{Labels}}} \\
    % \Picks(\Enter \beta)                       &=& \nothing \\
    % \Picks(\Update b)                          &=& \nothing \\
    % \Picks(\View b)                            &=& \nothing \\
    \Picks(\Pick \set{\more{L_i \mapsto t_i}}) &=& \set{L_i \mid \lnot\Failing(t_i)} \\
  \addlinespace
    % \Picks(\Done b)                            &=& \nothing \\
    % \Picks(t_1 \Pair t_2)                      &=& \nothing \\
    % \Picks(t_1 \Choose t_2)                    &=& \nothing \\
    % \Picks(\Fail)                              &=& \nothing \\
  % \addlinespace
    \Picks(e_1 \Trans t_2)                     &=& \Picks(t_2) \\
    \Picks(t_1 \Step e_2)                      &=& \Picks(t_1) \\
    \Picks(\Forever t)                         &=& \Picks(t) \\
  % \addlinespace
    % \Picks(\Share b)                           &=& \nothing \\
    % \Picks(l \Assign b)                        &=& \nothing \\
    % \Picks(\Change l)                          &=& \nothing \\
    % \Picks(\Watch l)                           &=& \nothing \\
  \addlinespace
    \Picks(\_)                                 &=& \nothing \\
  \end{function}
}

\newmacro{O-Inputs}{
  \begin{function}
    \signature{\Inputs : \mathrm{Tasks} \times \mathrm{States} \to \powerset{\mathrm{Inputs}}} \\
    \Inputs(\Enter \beta,\sigma)                      &=& \set{b':\beta} \\
    \Inputs(\Update b,\sigma)                         &=& \set{b':\beta} \quad\where\ \Update b : \Task\beta \\
    \Inputs(\View b,\sigma)                           &=& \nothing \\
    \Inputs(\Pick\set{\more{L_i \mapsto t_i}},\sigma) &=& \set{\IPick L_i \mid L_i \in \Picks(\Pick\set{\more{L_i \mapsto t_i}})} \\
  \addlinespace
    \Inputs(\Done v,\sigma)                           &=& \nothing \\
    \Inputs(t_1 \Pair t_2,\sigma)                     &=& \set{\First\ i \mid i \in \Inputs(t_1,\sigma)} \cup \set{\Second\ i \mid i \in \Inputs(t_2,\sigma)} \\
    \Inputs(t_1 \Choose t_2,\sigma)                   &=& \set{\First\ i \mid i \in \Inputs(t_1,\sigma)} \cup \set{\Second\ i \mid i \in \Inputs(t_2,\sigma)} \\
    \Inputs(\Fail,\sigma)                             &=& \nothing \\
  \addlinespace
    \Inputs(e_1 \Trans t_2,\sigma)                    &=& \Inputs(t_2,\sigma) \\
    \Inputs(t_1 \Step e_2,\sigma)                     &=& \Inputs(t_1,\sigma) \cup \set{\IContinue L_i \mid \Value(t_1,\sigma) = v_1, e_2\ v_1 \eval t_2, L_i \in \Picks(t_2) } \\
    \Inputs(\Forever t)                               &=& \Inputs(t,\sigma) \\
  \addlinespace
    \Inputs(\Change l,\sigma)                         &=& {\set{b':\beta}} \quad\where\ \Change l : \Task\beta \\
    \Inputs(\Watch l,\sigma)                          &=& \nothing \\
  \end{function}
}
